import os
from collections import defaultdict

from minari import list_remote_datasets


filtered_datasets = defaultdict(list)
all_remote_datasets = list_remote_datasets()

for dataset_name, dataset_spec in all_remote_datasets.items():

    env_name = dataset_name.split("-", 1)[0]

    filtered_datasets[env_name].append(dataset_spec)

for env_name, datasets_specs in filtered_datasets.items():
    datasets_specs = sorted(datasets_specs, key=lambda spec: spec["dataset_name"])

    for i, dataset_spec in enumerate(datasets_specs):
        if i == 0:
            related_pages_meta = "firstpage:\n"
        elif i == len(datasets_specs) - 1:
            related_pages_meta = "lastpage:\n"
        else:
            related_pages_meta = ""

        dataset_name = dataset_spec["dataset_name"]

        env_page = f"""---
autogenerated:
title: {"hery"}
{related_pages_meta}---
# {dataset_name}

## Dataset Specs

## Environment Specs

"""

        env_md_path = os.path.join(
            os.path.dirname(__file__),
            "..",
            "datasets",
            env_name,
            dataset_name + ".md",
        )
        file = open(env_md_path, "w", encoding="utf-8")
        file.write(env_page)
        file.close()
